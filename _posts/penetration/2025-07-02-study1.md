---
title:  "정보 수집 단계"
excerpt: "정보수집 단계에서 할 수 있는 것들에 대해 알아보자"

categories: penetration
tags:
  - [nmap]

typora-root-url: ../../
 
date: 2025-07-02
last_modified_at: 2025-08-25
---

## Port Scannig
```zsh
nmap -p <port> -sV -Pn -n -sC <ip>

## Nmap 유용 플래그

- -iL test.txt : 대상 호스트 파일 사용
- -p <포트>
    - `-p 80,443 <ip>`
    - `-p 80,443,8000-9000 --open <ip>` : 열린 포트만 검색
    - `-p-` : 1부터 65535 모든 포트 검색
- `--top-ports <숫자> <아이피>`:  가장 유명한 포트 <숫자>개만 스캔
- 속도 플래그
    - 속도 조절 : `-T1 ~ T5`
- 최소한 패킷 숫자 설정(최소한 매초 2000개의 패킷 전달)
    - `nmap --min-rate 2000 <ip>`
- host group 지정 (예: 대상 아이피나 DNS 이름이 들어간 파일에서 최소한 16개의 호스트 병렬 스캔
    - `nmap --min-hostgroup 16 -iL <대상파일>`
- 네트워크 서비스의 이름과 버전 확인
    - `-sV`
- Nmap 이 가지고 있는 정보수집 Prove 스크립트를 실행하는 플래그
    - `-sC`

#NSE 스크립트 
nmap -p <port> --script='스크립트 이름' <ip>

- 스크립트 저장된 위치: /usr/share/nmap/scripts

### NSE 활용 순서

1. 필요한 NSE 스크립트 검색
    1. 구글 검색 예시: wordpress theme enumeration nmap nse github
2. 스크립트 다운로드
    - `cd /usr/share/nmap/scripts`
    - `wget <스크립트 다운로드 주소>`
    - 또는 RAW 파일 내용 복사한 뒤 스크립트 저장 경로에 `sudo vim` 으로 nse 파일 생성 후 붙여넣기 해도 됨
3. 스크립트 사용
    - nmap -p <port> -sV --script <스크립트 이름> <ip>
```

## 취약점 진단 단계
### 21 - FTP
```bash
1. nmap -p 21 -sV -sC -Pn -n <ip>

2. searchsploit vsftpd <버전>

3. ftp 접속 후 읽기/쓰기 권한 확인

4. 기본 계정 및 비밀번호 확인, -> 특정 버전 취약점 검색
- Google: “vsftpd 3.0.3” default passwords
```

***

### 22 - SSH
```bash
1. namp -p 22 -sV -sC <ip>

2. # 유저 이름 정보 수집 - Metasploit
msfconsole > 
- `search ssh_enumuser`    - 찾고 싶은 모듈 검색
- `use axiliary/scanner/ssh/ssh_enumusers` - options 치면 옵션 나옴
- `set rhosts <ip>`
- `set rport 2222`
- `set user_file <filepath>`
    - Google: username seclist github
- run

3. 부루트포스 대응 미흡/부재 확인
- hydra -l thisuserdoesnotexist -P <passwords.txt> ssh://<ip>:<port> -V -f
  - sudo gzip -d /usr/share/wordlists/rockyou.txt.gz
     - 처음 칼리를 깔면 압축되어있음. 풀어주는 과정 필요
```

***

### 80/443 - Web
```bash
1. 버전 및 기술스택 확인 : Burpsuite
- 기술 스택 확인:  Google - wappalyzer chrome extension
- 크롤링 활용 : robots.txt

2. LFI(Local File Inclusion)
- LFI Payload 브루트포스
    - Google: lfimap GitHub
        - `git clone https://github.com/hansmach1ne/LFImap.git`
        - `wget https://github.com/hansmach1ne/LFImap.git`
        - `python3 -m venv venv`
        - `source venv/bin/activate`
        - `pip3 install -r requirements.txt`
    - `python3 [lfimap.py](http://lfimap.py/) --help`
    - `python3 [lfimap.py](http://lfimap.py) -U <url> -C <sessionID> -a`
        - `python3 [lfimap.py](http://lfimap.py/) -U "http://172.31.223.182:4280/vulnerabilities/fi/?page=file1.php" -C "PHPSESSID=519abd9f1d411d3dddd7c5e7fb804a7a; security=low" -a`

3. 커맨드 인젝션(Command Injection)
- Google: command injection payload github
    - 목록 복사하기
    - 인터셉트키고 프록시에서 인트루더로 보낸다음에 브루트포스 하고싶은 곳에 드래그 후 ADD 버튼 누름 → 복사한거 붙여넣고 공격 실행

4. 디렉토리 브루트포싱
- gobuster dir -u <url> -w <디렉토리리스트파일경로>
    - $ gobuster dir -u http://172.31.223.182:8081/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
        - gobuster는 재귀적으로 디렉토리 검색은 하지 않음(dirbusters는 재귀 사용 가능)
        - 명령어 뒤에 옵션으로 `-x php,git,txt,backup` 입력하면 파일도 찾기 가능
        - 옵션 `-t <숫자>` 로 스레드를 조정할 수 있지만 디도스가 될 수도 있음
        - 원하는 응답코드만 얻으려면 `-s "200,301,302" -b ""`
    - 고버스터에서 재귀적으로 찾고 싶다면, 이미 찾은 디렉토리를 다시 url 로 수정
    
 5. 파일 업로드 우회
 - 자동화 공격툴
    - Google: fuxploider github (almandin 이 만든거)
    - `git clone <경로>`
        - 가상환경 만들어서 설치하기
        - 가상환경에서 실행하기
        - `python3 [fuxploider.py](http://fuxploider.py/) --url http://172.31.223.182:4280/vulnerabilities/upload --cookies "PHPSESSID=519abd9f1d411d3dddd7c5e7fb804a7a; security=medium" --not-regex "not uploaded" -d "Upload=Upload"`
            - `--not-regex` : 이 단어가 포함되면 실패로 간주
            - `-d` : 필수 파라미터 데이터 삽입
```

***

### 445 - SMB
```bash
- Null Session: 계정 이름과 비밀번호 없이 접근 후 파일 업로드/다운로드 가능
- 파일 읽기, 쓰기 권한 확인
- 접근 가능한 쉐어(Share) 및 파일 확인
- 관련 취약점 확인 (MS08-067, MS17-010, SMBGhost, MS15-011 등)
- 네트워크 기반 공격: SMB Signing, SMBv1 등

1. nmap -p 445 -sV -sC -Pn -n <ip> : 버전 확인

2. enum4linux -a <ip> : 리눅스 정보 수집 툴
- Session Check on 섹션 확인(익명 로그인 가능한지 부분)
- 읽기 쓰기 권한 디렉토리 확인

3. 실무에서 쓰이는 툴
- Google: netexec github
    - 가상환경에서 `pip3 install pipx`설치
    - `pipx install git+https://github.com/Pennyw0rth/NetExec.git`
    - nxc smb <ip> -u ‘’ -p ‘’
- 칼리 기본 툴에서도 사용 가능 `smbmap -H <ip>`

- 접속하기
    - smbclient \\\\<ip>\\samba-share -U ""
    - get, put, ls 등 명령어 사용

- nmap -p 445 -sV --script="smb-vuln-*"
    - 진단 스크립트 사용 하는 방법
    - 리눅스에서 진단하면 별로 안나오고, 윈도우 서버를 진단하는 거면 많이나옴
```

***

### 111/2049 - NFS
```bash
### 1. nmap, showmount 로 정보수집:
- nmap -p 111,2049 -Pn -n --open <ip> --script="nfs-*" -sV
- showmount -e <ip> : nmap으로 정보 수집을 했지만 다시한번 더 확인
    
    Export list for 172.31.245.200:
    /public-nfs 172.31.0.0/16,10.0.0.0/8
    
    "현재 172.31.245.200 호스트의 NFS 서버는 `/public-nfs` 라는 Export를 `172.31.0.0/16`, `10.0.0.0/8`으로부터 접근을 허락하고 있다"
    

### 2. 파일 권한 확인
- sudo mkdir /mnt/testo
    - mount <nfsIP>:/<Export디렉토리> /mnt/testo
    - 마운트 된 폴더 들어가서 디렉토리 확인

### 3. No_Root_Squash 활성화 확인
- 활성화 되어 있다면 취약한 상태
- no_root_squash 옵션의 활성화 상태를 nfs 클라이언트가 원격에서 확인할 방법은 없음
    - 따라서 디렉토리 마운트한 뒤 직접 루트 계정으로 파일을 생성해보고, 생성이 가능하다면 활성화 되었있다고 볼 수 있음
- 파일의 owner와 group 모두 root 유저로 설정되어있다면 이것을 활용해 SUID 비트가 설정되어 있는 페이로드나 쉘을 업로드 할 경우, 타겟 호스트에서 낮은 권한의 유저에서 루트 유저로 권한 상승을 진행할 수도 있다.

- 마운트 끝내기: cd .. -> umount /mnt/<디렉토리이름>
```

***

### 3306 - MySQL
```bash
## 취약점 진단
- 버전 정보 및 호스트 이름 확인
- 접근 제어
- 기본 계정 및 단순한 사용자명/비밀번호
    - 예: `root:''` `root:password` `root:root` `dbadmin:password` 등
- 데이터베이스 확인: 원격에서 접근이 가능한 경우 DB안의 데이터 확인
    - 저장/미사용 데이터 암호화
    - 비밀번호 해시화
    - 해시 알고리즘 확인
    
### 1. Nmap 기본 스캔
- nmap -p <port> -Pn -n -sV --script="mysql*" <ip>

### 2. MySQL 접근
- mysql -u <user> -p -h <ip/hostname> -P <port> --ssl=FALSE
- → mysql -u root -p -h 172.31.1.1 -P 33060 --ssl=FALSE

### 3. MySQL 사용
- show databases;
- use <데이터베이스이름>;
- show tables;
- select * from <테이블이름>;
- select * from <테이블이름> where lower(<열>) like '%<문자열>%'; : 특정 열 내 특정 문자열 확인
    - MySQL [production]> select username,password from users where lower(username) like '%garcia%'; : 유저 이름 열 중 Garcia가 포함된 행의 username, password 반환

### 4. 원격 데이터베이스 덤프 후 암호화, 해시화 등 확인

- 특정 데이터 베이스 내 특정 테이블 덤프
    - mysqldump -h <ip/dns> -u <user> -p -P <포트> <DB이름> <테이블이름> > <파일이름>
    - 예: mysqldump -h 172.31.198.21 -u root -p -P 33060 production users > usertabledump.sql
- 특정 데이터 베이스 전체 덤프
    - mysqldump -h <ip/dns> -u <user> -p -P <포트> <DB이름> > <파일이름>
    - 예: mysqldump -h 172.31.198.21 -u root -p -P 33060 production > productiondbdump.sql

- 해시 알고리즘 확인
    - `hash-identifier` → hash 값 입력하기

- 해시 크랙 하기
    - john --format='raw-md5' --wordlist=/usr/share/wordlist/rockyou.txt <파일명>
    - 또는 hashcat -m 1000 -a 0 <파일명> --wordlist=/usr/share/wordlist/rockyou.txt
```

***

### 자동 취약점 진단 (Nuclei)
```bash
### Nuclei

- Nmap이나 Metasploit 과 비슷하게 양식(템플릿) 기반의 취약점 진단 스캐너.
- 본래 웹 보안 및 버그바운티용 스캐너로 개발되었지만, 추가적으로 DNS, SSL, 소스코드, 파일 형식, 네트워크 서비스 등의 다양한 타겟을 상대로 취약점 진단 가능. 단 원래 웹 보안용 스캐너였기 때문에 일반적인 네트워크 서비스 스캐닝은 부족함
- 설치 :
sudo apt update -y ; sudo apt install golang-go -y
go install -v [github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest](http://github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest)
echo 'export PATH=/home/kali/go/bin:$PATH' >> ~/.zshrc
source ~/.zshrc

- 사용법:
	- 기본 스캐닝 :
nuclei -u <IP/호스트이름/URL>:<포트>

# IP 주소
nuclei -u 172.31.1.1

# 웹 URL과 포트 
nuclei -u https://172.31.1.1:8443

# 일반 네트워크 서비스와 포트 
	nuclei -u 172.31.1.1:445
	

	- 웹 스캐닝 : 웹 서버나 웹 애플리케이션을 스캔할 때는 URL 설정을 해야한다. 또한 웹 스캐닝을 진행할때는 -as (automatic scannig)플래그를 이용해 Nuclei가 타켓의 기술스택을 자동적으로 판단한 뒤 알맞는 양식을 사용하도록 하는 것이 효율적
	nuclei -u http[s]://<ip>:<port> -as 

	└─$ nuclei -u http://172.31.198.21:8081 -as
	
	
	- 네트워크 스캐닝 : 웹 서버나 웹 애플리케이션이 아닌, 일반적인 네트워크 서비스(SSH, FTP, NFS, SMB 등)을 스캐닝할 경우 (exclude templet) -et http/ 플래그를 사용해 웹(http)과 관련된 양식들은 모두 제외한 채 스캐닝을 진행
	nuclei -u <ip>:<port> -et http/ 

└─$ nuclei -u 172.31.198.21:2100 -et http/


# 1초당 최대 HTTP 요청 50개로 제한, 병렬적으로 실행하는 양식 갯수 10개로 제한 
nuclei -u http://172.31.198.21:8081 -as -rl 50 -c 10
```